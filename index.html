<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Private Matrix</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: #f0f4f8; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* –°—Ç–∏–ª–∏ –≤—Ö–æ–¥–∞ */
        #auth-container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; margin-top: 40px; text-align: center; }
        .auth-input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; outline: none; }
        .auth-btn { width: 100%; padding: 14px; background: #222; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* –ú–∞—Ç—Ä–∏—Ü–∞ */
        #main-content { display: none; width: 100%; max-width: 850px; }
        .matrix { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .matrix { grid-template-columns: 1fr 1fr; } }
        
        .quadrant { background: white; padding: 15px; border-radius: 18px; border-top: 6px solid; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .q1 { border-color: #ff4d4d; } .q2 { border-color: #007bff; }
        .q3 { border-color: #ffc107; } .q4 { border-color: #28a745; }

        .header-ui { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%; }
        .input-group { display: flex; gap: 5px; margin-bottom: 15px; }
        .item { background: #fdfdfd; padding: 12px; border-radius: 12px; margin-bottom: 8px; border: 1px solid #f0f0f0; position: relative; }
        .del-btn { position: absolute; right: 10px; top: 10px; color: #ccc; border: none; background: none; font-size: 1.2rem; cursor: pointer; }
        #loader { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.8); z-index: 100; align-items: center; justify-content: center; font-weight: bold; }
    </style>
</head>
<body>

<div id="loader">‚öôÔ∏è –û–±–ª–∞—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞...</div>

<div id="auth-container">
    <h2>–õ–∏—á–Ω–æ–µ –û–±–ª–∞–∫–æ</h2>
    <input type="email" id="email" class="auth-input" placeholder="–í–∞—à Email">
    <input type="password" id="password" class="auth-input" placeholder="–í–∞—à –ü–∞—Ä–æ–ª—å">
    <button class="auth-btn" onclick="handleAuth('login')">–í–æ–π—Ç–∏</button>
    <button class="auth-btn" style="background: #888;" onclick="handleAuth('register')">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
</div>

<div id="main-content">
    <div class="header-ui">
        <b>Master Matrix Online</b>
        <button onclick="firebase.auth().signOut()" style="border:none; color:red; background:none; cursor:pointer;">–í—ã–π—Ç–∏</button>
    </div>

    <div class="matrix">
        <div class="quadrant q1">
            <h4>üî• –°—Ä–æ—á–Ω–æ</h4>
            <div class="input-group">
                <input type="text" id="in1" placeholder="–î–µ–ª–æ...">
                <button onclick="document.getElementById('f1').click()">üìé</button>
                <input type="file" id="f1" style="display:none" onchange="uploadFile(1)">
                <button onclick="addTask(1)">+</button>
            </div>
            <div id="l1"></div>
        </div>

        <div class="quadrant q2">
            <h4>üìÖ –í–∞–∂–Ω–æ</h4>
            <div class="input-group">
                <input type="text" id="in2" placeholder="–ü–ª–∞–Ω–∏—Ä—É–π...">
                <button onclick="document.getElementById('f2').click()">üìé</button>
                <input type="file" id="f2" style="display:none" onchange="uploadFile(2)">
                <button onclick="addTask(2)">+</button>
            </div>
            <div id="l2"></div>
        </div>
    </div>
</div>

<script>
    // –î–ê–ù–ù–´–ï –° –¢–í–û–ò–• –°–ö–†–ò–ù–®–û–¢–û–í
    const firebaseConfig = {
        apiKey: "AIzaSyAm7l3kLNaXW90TyN9gFS2pwfdseimErdc",
        authDomain: "fail-21187.firebaseapp.com",
        databaseURL: "https://fail-21187-default-rtdb.firebaseio.com",
        projectId: "fail-21187",
        appId: "1:621043286513:web:dc826eaa4ddebb5cc14450"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            sync(user.uid);
        } else {
            document.getElementById('auth-container').style.display = 'block';
            document.getElementById('main-content').style.display = 'none';
        }
    });

    async function handleAuth(mode) {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        try {
            if(mode === 'register') await auth.createUserWithEmailAndPassword(e, p);
            else await auth.signInWithEmailAndPassword(e, p);
        } catch(err) { alert("–û—à–∏–±–∫–∞: " + err.message); }
    }

    function sync(uid) {
        db.ref('users/' + uid).on('value', snap => {
            [1,2].forEach(i => document.getElementById('l'+i).innerHTML = '');
            snap.forEach(child => {
                const item = child.val();
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <div>${item.type==='file'?'üìÑ':'üìå'} <b>${item.text}</b></div>
                    <button class="del-btn" onclick="db.ref('users/${uid}/${child.key}').remove()">‚úï</button>
                    ${item.data ? `<a href="${item.data}" download="${item.text}" style="font-size:12px; color:#007bff; text-decoration:none; font-weight:bold;">–°–ö–ê–ß–ê–¢–¨</a>` : ''}
                `;
                document.getElementById('l'+item.q).prepend(div);
            });
        });
    }

    async function addTask(q) {
        const val = document.getElementById('in'+q).value;
        if(val) {
            await db.ref('users/' + auth.currentUser.uid).push({ q, text: val, type: 'text' });
            document.getElementById('in'+q).value = '';
        }
    }

    function uploadFile(q) {
        const file = document.getElementById('f'+q).files[0];
        if(!file) return;
        const reader = new FileReader();
        document.getElementById('loader').style.display = 'flex';
        reader.onload = async (e) => {
            await db.ref('users/' + auth.currentUser.uid).push({
                q, text: file.name, data: e.target.result, type: 'file'
            });
            document.getElementById('loader').style.display = 'none';
        };
        reader.readAsDataURL(file);
    }
</script>
</body>
</html>
