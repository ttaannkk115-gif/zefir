<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Private Cloud</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        body { background: #f0f2f5; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
        #auth-form { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 320px; margin-top: 60px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; outline: none; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .login-btn { background: #222; color: white; margin-top: 10px; }
        .login-btn:active { transform: scale(0.98); }
        .reg-link { background: none; color: #007bff; font-size: 13px; margin-top: 15px; text-decoration: underline; border: none; }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #app { display: none; width: 100%; max-width: 800px; }
        .matrix { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 15px; }
        @media (min-width: 600px) { .matrix { grid-template-columns: 1fr 1fr; } }
        
        .quadrant { background: white; padding: 15px; border-radius: 15px; border-top: 6px solid #333; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .item { background: #f9f9f9; padding: 12px; margin-top: 10px; border-radius: 10px; position: relative; border: 1px solid #eee; font-size: 14px; word-break: break-all; }
        .del { position: absolute; right: 10px; top: 10px; color: #ff4d4d; border: none; background: none; cursor: pointer; font-size: 18px; padding: 0; }
        
        #loader { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.8); z-index: 100; align-items: center; justify-content: center; font-weight: bold; flex-direction: column; }
        .file-link { display: inline-block; margin-top: 8px; color: #007bff; text-decoration: none; font-weight: bold; font-size: 12px; border: 1px solid #007bff; padding: 4px 8px; border-radius: 5px; }
    </style>
</head>
<body>

<div id="loader"><div>‚öôÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –æ–±–ª–∞–∫–æ...</div></div>

<div id="auth-form">
    <h2 style="margin: 0 0 15px 0;">Master Cloud</h2>
    <input type="text" id="user-login" placeholder="–õ–æ–≥–∏–Ω (–Ω–∞–ø—Ä. Gazik115)">
    <input type="password" id="user-pass" placeholder="–ü–∞—Ä–æ–ª—å">
    <button class="btn login-btn" onclick="go('login')">–í–û–ô–¢–ò</button>
    <button class="btn reg-link" onclick="go('reg')">–£ –º–µ–Ω—è –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞, —Å–æ–∑–¥–∞—Ç—å</button>
</div>

<div id="app">
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 12px; margin-bottom: 10px;">
        <span id="display-user" style="font-weight: bold;">‚òÅÔ∏è –û–±–ª–∞–∫–æ</span>
        <button onclick="firebase.auth().signOut()" style="border:none; background:none; color:#ff4d4d; cursor:pointer; font-weight:bold;">–í—ã–π—Ç–∏</button>
    </div>

    <div class="matrix">
        <div class="quadrant" style="border-color: #ff4d4d;">
            <h4 style="margin:0 0 12px 0">üî• –°–†–û–ß–ù–û / –í–ê–ñ–ù–û</h4>
            <div style="display:flex; gap:8px;">
                <input type="text" id="in1" placeholder="–î–µ–ª–æ..." style="margin:0">
                <button style="border-radius:10px; border:1px solid #ddd; background:#eee; padding: 0 10px;" onclick="document.getElementById('f1').click()">üìé</button>
                <input type="file" id="f1" style="display:none" onchange="up(1)">
                <button class="btn login-btn" style="width:45px; margin:0; border-radius:10px;" onclick="add(1)">+</button>
            </div>
            <div id="l1"></div>
        </div>

        <div class="quadrant" style="border-color: #007bff;">
            <h4 style="margin:0 0 12px 0">üìÖ –í–ê–ñ–ù–û / –ù–ï –°–†–û–ß–ù–û</h4>
            <div style="display:flex; gap:8px;">
                <input type="text" id="in2" placeholder="–ó–∞–º–µ—Ç–∫–∞..." style="margin:0">
                <button style="border-radius:10px; border:1px solid #ddd; background:#eee; padding: 0 10px;" onclick="document.getElementById('f2').click()">üìé</button>
                <input type="file" id="f2" style="display:none" onchange="up(2)">
                <button class="btn login-btn" style="width:45px; margin:0; border-radius:10px;" onclick="add(2)">+</button>
            </div>
            <div id="l2"></div>
        </div>
    </div>
</div>

<script>
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –° –¢–í–û–ò–• –°–ö–†–ò–ù–®–û–¢–û–í
    const firebaseConfig = {
        apiKey: "AIzaSyAm7l3kLNaXW90TyN9gFS2pwfdseimErdc",
        authDomain: "fail-21187.firebaseapp.com",
        databaseURL: "https://fail-21187-default-rtdb.firebaseio.com",
        projectId: "fail-21187",
        storageBucket: "fail-21187.appspot.com",
        appId: "1:621043286513:web:dc826eaa4ddebb5cc14450"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ –ø—Ä–∏ –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ
    auth.onAuthStateChanged(user => {
        document.getElementById('auth-form').style.display = user ? 'none' : 'block';
        document.getElementById('app').style.display = user ? 'block' : 'none';
        if(user) {
            document.getElementById('display-user').innerText = "–ê–∫–∫–∞—É–Ω—Ç: " + user.email.split('@')[0];
            sync(user.uid);
        }
    });

    // –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    async function go(mode) {
        let login = document.getElementById('user-login').value;
        const pass = document.getElementById('user-pass').value;
        if(!login || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!");
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –ª–æ–≥–∏–Ω–∞ –≤ email –¥–ª—è Firebase
        const email = login.includes('@') ? login : login + "@master.cloud";

        try {
            if(mode === 'reg') {
                await auth.createUserWithEmailAndPassword(email, pass);
                alert("–£—Å–ø–µ—Ö! –¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏ '–í–æ–π—Ç–∏'");
            } else {
                await auth.signInWithEmailAndPassword(email, pass);
            }
        } catch(e) { alert("–û—à–∏–±–∫–∞: " + e.message); }
    }

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –±–∞–∑–æ–π
    function sync(uid) {
        db.ref('users/' + uid).on('value', snap => {
            [1,2].forEach(i => document.getElementById('l'+i).innerHTML = '');
            snap.forEach(child => {
                const val = child.val();
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <div>${val.f ? 'üìÑ' : 'üìå'} <b>${val.t}</b></div>
                    <button class="del" onclick="db.ref('users/${uid}/${child.key}').remove()">‚úï</button>
                    ${val.f ? `<a href="${val.f}" download="${val.t}" class="file-link">–°–ö–ê–ß–ê–¢–¨ –§–ê–ô–õ</a>` : ''}
                `;
                document.getElementById('l'+val.q).prepend(div);
            });
        });
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
    async function add(q) {
        const text = document.getElementById('in'+q).value;
        if(!text) return;
        await db.ref('users/' + auth.currentUser.uid).push({ q, t: text });
        document.getElementById('in'+q).value = '';
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (Base64 - –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
    function up(q) {
        const file = document.getElementById('f'+q).files[0];
        if(!file) return;
        
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –±–∞–∑—ã (~10MB)
        if(file.size > 8 * 1024 * 1024) return alert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –õ–∏–º–∏—Ç 8–ú–ë.");

        document.getElementById('loader').style.display = 'flex';
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                await db.ref('users/' + auth.currentUser.uid).push({
                    q, t: file.name, f: e.target.result
                });
            } catch(err) { alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏!"); }
            document.getElementById('loader').style.display = 'none';
            document.getElementById('f'+q).value = '';
        };
        reader.readAsDataURL(file);
    }
</script>
</body>
</html>
