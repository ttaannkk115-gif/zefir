<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Private Cloud</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; }
        body { background: #121212; color: white; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        #auth-form { background: #1e1e1e; padding: 25px; border-radius: 20px; width: 100%; max-width: 320px; margin-top: 50px; text-align: center; border: 1px solid #333; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #444; border-radius: 10px; background: #2a2a2a; color: white; font-size: 16px; outline: none; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .login-btn { background: #ffffff; color: #000; }
        .reg-link { background: none; color: #007bff; font-size: 13px; text-decoration: underline; margin-top: 15px; }
        #app { display: none; width: 100%; max-width: 500px; }
        .quadrant { background: #1e1e1e; padding: 15px; border-radius: 15px; margin-top: 15px; border-left: 5px solid #ff4d4d; }
        .item { background: #2a2a2a; padding: 10px; margin-top: 8px; border-radius: 8px; position: relative; border: 1px solid #333; font-size: 14px; }
        .del { position: absolute; right: 8px; top: 8px; color: #ff4d4d; background: none; border: none; cursor: pointer; font-weight: bold; }
        #loader { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; font-weight: bold; }
    </style>
</head>
<body>

<div id="loader">‚öôÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</div>

<div id="auth-form">
    <h2 style="margin-top:0">Master Cloud</h2>
    <input type="text" id="user-login" placeholder="–õ–æ–≥–∏–Ω (–Ω–∞–ø—Ä: Gazik115)">
    <input type="password" id="user-pass" placeholder="–ü–∞—Ä–æ–ª—å">
    <button class="btn login-btn" onclick="go('login')">–í–û–ô–¢–ò</button>
    <button class="btn reg-link" onclick="go('reg')">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –°–æ–∑–¥–∞—Ç—å</button>
</div>

<div id="app">
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
        <b style="color: #007bff;">‚òÅÔ∏è –¢–≤–æ–µ –û–±–ª–∞–∫–æ</b>
        <button onclick="firebase.auth().signOut()" style="border:none; background:none; color:#ff4d4d; cursor:pointer; font-weight:bold;">–í—ã—Ö–æ–¥</button>
    </div>

    <div class="quadrant">
        <h4 style="margin:0 0 10px 0; color: #ff4d4d;">üî• –°–†–û–ß–ù–û / –í–ê–ñ–ù–û</h4>
        <div style="display:flex; gap:5px;">
            <input type="text" id="in1" placeholder="–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å..." style="margin:0">
            <button class="login-btn" style="width:45px; margin:0; border-radius:10px;" onclick="add()">+</button>
        </div>
        <div id="list"></div>
    </div>
</div>

<script>
    // –î–ê–ù–ù–´–ï –° –¢–í–û–ò–• –°–ö–†–ò–ù–®–û–¢–û–í (–§–ò–ù–ê–õ–¨–ù–´–ï)
    const firebaseConfig = {
        apiKey: "AIzaSyAm7l3kLNaXW90TyN9gFS2pwfdseimErdc",
        authDomain: "fail-21187.firebaseapp.com",
        databaseURL: "https://fail-21187-default-rtdb.firebaseio.com",
        projectId: "fail-21187",
        appId: "1:621043286513:web:dc826eaa4ddebb5cc14450"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
        document.getElementById('auth-form').style.display = user ? 'none' : 'block';
        document.getElementById('app').style.display = user ? 'block' : 'none';
        if(user) sync(user.uid);
    });

    async function go(mode) {
        let login = document.getElementById('user-login').value;
        const pass = document.getElementById('user-pass').value;
        if(!login || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");
        
        // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –ª–æ–≥–∏–Ω –≤ –ø–æ—á—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        const email = login.includes('@') ? login : login + "@m.ru";

        try {
            if(mode === 'reg') {
                await auth.createUserWithEmailAndPassword(email, pass);
                alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω!");
            } else {
                await auth.signInWithEmailAndPassword(email, pass);
            }
        } catch(e) { 
            alert("–û—à–∏–±–∫–∞: " + e.message); 
            console.error(e);
        }
    }

    function sync(uid) {
        db.ref('users/' + uid).on('value', snap => {
            const list = document.getElementById('list');
            list.innerHTML = '';
            snap.forEach(child => {
                const val = child.val();
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <span>üìå ${val.t}</span>
                    <button class="del" onclick="db.ref('users/${uid}/${child.key}').remove()">‚úï</button>
                `;
                list.prepend(div);
            });
        });
    }

    async function add() {
        const text = document.getElementById('in1').value;
        if(!text) return;
        await db.ref('users/' + auth.currentUser.uid).push({ t: text });
        document.getElementById('in1').value = '';
    }
</script>
</body>
</html>

