<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Private Cloud</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: #f0f2f5; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        #auth-form { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 320px; margin-top: 60px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; outline: none; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .login-btn { background: #222; color: white; margin-top: 10px; }
        .reg-link { background: none; color: #007bff; font-size: 13px; margin-top: 15px; text-decoration: underline; border: none; cursor: pointer; }
        #app { display: none; width: 100%; max-width: 800px; }
        .matrix { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 15px; }
        @media (min-width: 600px) { .matrix { grid-template-columns: 1fr 1fr; } }
        .quadrant { background: white; padding: 15px; border-radius: 15px; border-top: 6px solid #333; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .item { background: #f9f9f9; padding: 10px; margin-top: 8px; border-radius: 10px; position: relative; border: 1px solid #eee; font-size: 14px; word-break: break-all; }
        .del { position: absolute; right: 8px; top: 8px; color: #ccc; border: none; background: none; cursor: pointer; font-size: 18px; }
        #loader { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.8); z-index: 100; align-items: center; justify-content: center; font-weight: bold; }
        .file-link { display: inline-block; margin-top: 5px; color: #007bff; text-decoration: none; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

<div id="loader">‚öôÔ∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</div>

<div id="auth-form">
    <h2 style="margin-top:0">Master Cloud</h2>
    <input type="text" id="user-login" placeholder="–õ–æ–≥–∏–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: Gazik115)">
    <input type="password" id="user-pass" placeholder="–ü–∞—Ä–æ–ª—å">
    <button class="btn login-btn" onclick="go('login')">–í–û–ô–¢–ò</button>
    <button class="btn reg-link" onclick="go('reg')">–£ –º–µ–Ω—è –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞, —Å–æ–∑–¥–∞—Ç—å</button>
</div>

<div id="app">
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
        <b id="user-name">‚òÅÔ∏è –ú–æ—ë –û–±–ª–∞–∫–æ</b>
        <button onclick="firebase.auth().signOut()" style="border:none; background:none; color:red; cursor:pointer; font-weight:bold;">–í—ã—Ö–æ–¥</button>
    </div>

    <div class="matrix">
        <div class="quadrant" style="border-color: #ff4d4d;">
            <h4 style="margin:0 0 10px 0">üî• –°–†–û–ß–ù–û</h4>
            <div style="display:flex; gap:5px;">
                <input type="text" id="in1" placeholder="–î–µ–ª–æ..." style="margin:0">
                <button style="border-radius:10px; border:1px solid #ddd; background:#eee;" onclick="document.getElementById('f1').click()">üìé</button>
                <input type="file" id="f1" style="display:none" onchange="up(1)">
                <button class="login-btn" style="width:40px; margin:0; border-radius:10px;" onclick="add(1)">+</button>
            </div>
            <div id="l1"></div>
        </div>

        <div class="quadrant" style="border-color: #007bff;">
            <h4 style="margin:0 0 10px 0">üìÖ –í–ê–ñ–ù–û</h4>
            <div style="display:flex; gap:5px;">
                <input type="text" id="in2" placeholder="–ó–∞–º–µ—Ç–∫–∞..." style="margin:0">
                <button style="border-radius:10px; border:1px solid #ddd; background:#eee;" onclick="document.getElementById('f2').click()">üìé</button>
                <input type="file" id="f2" style="display:none" onchange="up(2)">
                <button class="login-btn" style="width:40px; margin:0; border-radius:10px;" onclick="add(2)">+</button>
            </div>
            <div id="l2"></div>
        </div>
    </div>
</div>

<script>
    // –¢–í–û–ò –î–ê–ù–ù–´–ï –ò–ó –°–ö–†–ò–ù–®–û–¢–ê
    const firebaseConfig = {
        apiKey: "AIzaSyAm7l3kLNaXW90TyN9gFS2pwfdseimErdc",
        authDomain: "fail-21187.firebaseapp.com",
        databaseURL: "https://fail-21187-default-rtdb.firebaseio.com",
        projectId: "fail-21187",
        storageBucket: "fail-21187.appspot.com",
        messagingSenderId: "621043286513",
        appId: "1:621043286513:web:dc826eaa4ddebb5cc14450"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
        document.getElementById('auth-form').style.display = user ? 'none' : 'block';
        document.getElementById('app').style.display = user ? 'block' : 'none';
        if(user) {
            document.getElementById('user-name').innerText = "–ü—Ä–∏–≤–µ—Ç, " + user.email.split('@')[0];
            sync(user.uid);
        }
    });

    async function go(mode) {
        let login = document.getElementById('user-login').value;
        const pass = document.getElementById('user-pass').value;
        if(!login || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");
        
        const email = login.includes('@') ? login : login + "@master.ru";

        try {
            if(mode === 'reg') {
                await auth.createUserWithEmailAndPassword(email, pass);
                alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –ù–∞–∂–º–∏ '–í–æ–π—Ç–∏'");
            } else {
                await auth.signInWithEmailAndPassword(email, pass);
            }
        } catch(e) { alert("–û—à–∏–±–∫–∞: " + e.message); }
    }

    function sync(uid) {
        db.ref('users/' + uid).on('value', snap => {
            [1,2].forEach(i => document.getElementById('l'+i).innerHTML = '');
            snap.forEach(child => {
                const val = child.val();
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <div>${val.f ? 'üìÑ' : 'üìå'} ${val.t}</div>
                    <button class="del" onclick="db.ref('users/${uid}/${child.key}').remove()">‚úï</button>
                    ${val.f ? `<a href="${val.f}" download="${val.t}" class="file-link">–°–ö–ê–ß–ê–¢–¨</a>` : ''}
                `;
                document.getElementById('l'+val.q).prepend(div);
            });
        });
    }

    async function add(q) {
        const text = document.getElementById('in'+q).value;
        if(!text) return;
        await db.ref('users/' + auth.currentUser.uid).push({ q, t: text });
        document.getElementById('in'+q).value = '';
    }

    function up(q) {
        const file = document.getElementById('f'+q).files[0];
        if(!file) return;
        document.getElementById('loader').style.display = 'flex';
        const reader = new FileReader();
        reader.onload = async (e) => {
            await db.ref('users/' + auth.currentUser.uid).push({ q, t: file.name, f: e.target.result });
            document.getElementById('loader').style.display = 'none';
            document.getElementById('f'+q).value = '';
        };
        reader.readAsDataURL(file);
    }
</script>
</body>
</html>
