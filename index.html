<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matrix Pro Max</title>
    <style>
        :root {
            --q1: #ff4d4d; --q2: #007bff; --q3: #ffc107; --q4: #28a745;
            --bg: #121212; --card-bg: #1e1e1e; --input-bg: #2d2d2d;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; }
        .container { max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; }
        
        .card { background: var(--card-bg); border-radius: 12px; padding: 12px; border-left: 5px solid; }
        .q1 { border-color: var(--q1); } .q2 { border-color: var(--q2); }
        .q3 { border-color: var(--q3); } .q4 { border-color: var(--q4); }
        
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        input[type="text"] { background: var(--input-bg); border: 1px solid #444; border-radius: 8px; padding: 10px; color: white; font-size: 16px; }
        
        .controls { display: flex; gap: 5px; }
        .file-btn { flex: 1; background: #333; border-radius: 8px; padding: 10px; font-size: 0.75rem; text-align: center; border: 1px dashed #555; cursor: pointer; }
        .add-btn { background: white; border: none; border-radius: 8px; width: 50px; font-weight: bold; font-size: 20px; }

        .task-list { list-style: none; padding: 0; margin-top: 10px; }
        .task-item { background: var(--input-bg); margin-bottom: 8px; padding: 10px; border-radius: 8px; position: relative; }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px; }
        .task-text { font-size: 0.95rem; color: #efefef; padding-right: 25px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —Ñ–∞–π–ª–∞ */
        .file-row { 
            display: flex; align-items: center; gap: 8px; 
            background: rgba(0,0,0,0.2); padding: 6px 10px; border-radius: 6px; margin-top: 5px;
        }
        .file-info { flex: 1; font-size: 0.8rem; color: #4da3ff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
        .file-actions { display: flex; gap: 12px; }
        .icon-btn { background: none; border: none; padding: 4px; cursor: pointer; font-size: 1.1rem; filter: grayscale(1); transition: 0.2s; }
        .icon-btn:active { transform: scale(1.2); filter: grayscale(0); }

        .del-btn { position: absolute; right: 8px; top: 8px; color: #555; background: none; border: none; font-size: 16px; }
        
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
        #modal img { max-width: 95%; max-height: 95%; }
    </style>
</head>
<body>

    <h2 style="text-align: center; color: #666; font-size: 1.2rem;">MATRIX ULTRA</h2>

    <div class="container">
        <div class="card q1">
            <h3 style="color:var(--q1); margin:0 0 8px 0; font-size:0.8rem;">–í–ê–ñ–ù–û / –°–†–û–ß–ù–û</h3>
            <div class="input-group">
                <input type="text" id="in1" placeholder="–ó–∞–¥–∞—á–∞...">
                <div class="controls">
                    <label class="file-btn" id="lab1">üìé –§–∞–π–ª<input type="file" id="f1" hidden onchange="updateLab(1)"></label>
                    <button class="add-btn" onclick="addTask(1)">+</button>
                </div>
            </div>
            <div id="list1" class="task-list"></div>
        </div>
        <div id="other-sections"></div>
    </div>

    <div id="modal" onclick="this.style.display='none'"><img id="modalImg"></div>

    <script>
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–µ–∫—Ç–æ—Ä–æ–≤
        const extraSectors = [
            {id:2, t:'–í–ê–ñ–ù–û / –ù–ï–°–†–û–ß–ù–û', c:'var(--q2)'},
            {id:3, t:'–ù–ï–í–ê–ñ–ù–û / –°–†–û–ß–ù–û', c:'var(--q3)'},
            {id:4, t:'–ù–ï–í–ê–ñ–ù–û / –ù–ï–°–†–û–ß–ù–û', c:'var(--q4)'}
        ];
        extraSectors.forEach(s => {
            document.getElementById('other-sections').innerHTML += `
                <div class="card q${s.id}" style="margin-top:15px">
                    <h3 style="color:${s.c}; margin:0 0 8px 0; font-size:0.8rem;">${s.t}</h3>
                    <div class="input-group">
                        <input type="text" id="in${s.id}" placeholder="–ó–∞–¥–∞—á–∞...">
                        <div class="controls">
                            <label class="file-btn" id="lab${s.id}">üìé –§–∞–π–ª<input type="file" id="f${s.id}" hidden onchange="updateLab(${s.id})"></label>
                            <button class="add-btn" onclick="addTask(${s.id})">+</button>
                        </div>
                    </div>
                    <div id="list${s.id}" class="task-list"></div>
                </div>`;
        });

        window.onload = () => {
            for(let i=1; i<=4; i++) {
                const saved = JSON.parse(localStorage.getItem('matrix_mpx_' + i) || '[]');
                saved.forEach(t => render(i, t));
            }
        };

        function updateLab(id) {
            const f = document.getElementById('f' + id).files[0];
            document.getElementById('lab' + id).innerText = f ? "‚úÖ " + f.name.substring(0,5) : "üìé –§–∞–π–ª";
        }

        async function addTask(q) {
            const inpt = document.getElementById('in' + q);
            const fInpt = document.getElementById('f' + q);
            if(!inpt.value.trim()) return;

            let fData = null, fName = "—Ñ–∞–π–ª", isImg = false;
            if(fInpt.files[0]) {
                fName = fInpt.files[0].name;
                isImg = fInpt.files[0].type.startsWith('image/');
                fData = await new Promise(r => {
                    const rd = new FileReader(); rd.readAsDataURL(fInpt.files[0]);
                    rd.onload = () => r(rd.result);
                });
            }

            const task = { text: inpt.value, fData, fName, isImg };
            render(q, task);
            save(q);
            inpt.value = ''; fInpt.value = ''; document.getElementById('lab' + q).innerText = "üìé –§–∞–π–ª";
        }

        function render(q, task) {
            const list = document.getElementById('list' + q);
            const div = document.createElement('div');
            div.className = 'task-item';
            
            let fileHtml = '';
            if(task.fData) {
                fileHtml = `
                <div class="file-row">
                    <div class="file-info" onclick="${task.isImg ? `openFull('${task.fData}')` : ''}">
                        ${task.isImg ? 'üñºÔ∏è' : 'üìÑ'} ${task.fName}
                    </div>
                    <div class="file-actions">
                        <button class="icon-btn" onclick="downloadFile('${task.fData}', '${task.fName}')" title="–°–∫–∞—á–∞—Ç—å">üì•</button>
                        <button class="icon-btn" onclick="shareTask('${task.text}')" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è">üì§</button>
                    </div>
                </div>`;
            }

            div.innerHTML = `
                <div class="task-header"><span class="task-text">${task.text}</span></div>
                ${fileHtml}
                <button class="del-btn" onclick="remove(this, ${q})">‚úï</button>
            `;
            list.appendChild(div);
        }

        function openFull(src) {
            document.getElementById('modalImg').src = src;
            document.getElementById('modal').style.display = 'flex';
        }

        function downloadFile(data, name) {
            const a = document.createElement('a'); a.href = data; a.download = name; a.click();
        }

        async function shareTask(txt) {
            if (navigator.share) navigator.share({ text: txt }).catch(() => {});
            else { alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!"); navigator.clipboard.writeText(txt); }
        }

        function remove(btn, q) { btn.parentElement.remove(); save(q); }

        function save(q) {
            const tasks = [];
            document.querySelectorAll(`#list${q} .task-item`).forEach(el => {
                const fInfo = el.querySelector('.file-info');
                const fDl = el.querySelector('[onclick^="downloadFile"]');
                tasks.push({
                    text: el.querySelector('.task-text').innerText,
                    fData: fDl ? fDl.getAttribute('onclick').split("'")[1] : null,
                    fName: fInfo ? fInfo.innerText.split(' ').slice(1).join(' ') : null,
                    isImg: fInfo && fInfo.innerText.includes('üñºÔ∏è')
                });
            });
            localStorage.setItem('matrix_mpx_' + q, JSON.stringify(tasks));
        }
    </script>
</body>
</html>
