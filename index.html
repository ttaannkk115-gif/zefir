<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Matrix Private</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: #f4f7f9; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        #auth-ui, #app-ui { width: 100%; max-width: 400px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-top: 20px; }
        #app-ui { display: none; max-width: 800px; }
        .auth-input, .task-input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .btn-main { background: #222; color: white; }
        .matrix { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 600px) { .matrix { grid-template-columns: 1fr 1fr; } }
        .quadrant { border-top: 5px solid #333; padding: 10px; background: #fafafa; border-radius: 10px; }
        .item { background: white; padding: 10px; margin-top: 10px; border-radius: 8px; position: relative; border: 1px solid #eee; }
        .del { position: absolute; right: 5px; top: 5px; color: #ff4d4d; border: none; background: none; cursor: pointer; }
        #loader { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.8); z-index: 100; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="loader">‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ–±–ª–∞–∫–µ...</div>

<div id="auth-ui">
    <h2 style="text-align: center;">–í—Ö–æ–¥ –≤ –û–±–ª–∞–∫–æ</h2>
    <input type="email" id="email" class="auth-input" placeholder="Email">
    <input type="password" id="pass" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å">
    <button class="btn btn-main" onclick="authAction('login')">–í–æ–π—Ç–∏</button>
    <button class="btn" style="background:#eee" onclick="authAction('reg')">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
</div>

<div id="app-ui">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <b>–õ–∏—á–Ω–∞—è –ú–∞—Ç—Ä–∏—Ü–∞</b>
        <button onclick="firebase.auth().signOut()" style="border:none; color:red; background:none; cursor:pointer;">–í—ã—Ö–æ–¥</button>
    </div>
    <div class="matrix" style="margin-top: 20px;">
        <div class="quadrant" style="border-color: #ff4d4d;">
            <h4>üî• –°—Ä–æ—á–Ω–æ</h4>
            <div style="display: flex; gap: 5px;">
                <input type="text" id="in1" class="task-input" placeholder="–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å?" style="margin:0">
                <button onclick="document.getElementById('f1').click()">üìé</button>
                <input type="file" id="f1" style="display:none" onchange="upFile(1)">
                <button class="btn-main" style="width: 40px; margin: 0; border-radius: 8px;" onclick="addText(1)">+</button>
            </div>
            <div id="l1"></div>
        </div>
        <div class="quadrant" style="border-color: #007bff;">
            <h4>üìÖ –í–∞–∂–Ω–æ</h4>
            <div style="display: flex; gap: 5px;">
                <input type="text" id="in2" class="task-input" placeholder="–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å..." style="margin:0">
                <button onclick="document.getElementById('f2').click()">üìé</button>
                <input type="file" id="f2" style="display:none" onchange="upFile(2)">
                <button class="btn-main" style="width: 40px; margin: 0; border-radius: 8px;" onclick="addText(2)">+</button>
            </div>
            <div id="l2"></div>
        </div>
    </div>
</div>

<script>
    // –î–ê–ù–ù–´–ï –° –í–ê–®–ò–• –°–ö–†–ò–ù–®–û–¢–û–í
    const firebaseConfig = {
        apiKey: "AIzaSyAm7l3kLNaXW90TyN9gFS2pwfdseimErdc",
        authDomain: "fail-21187.firebaseapp.com",
        databaseURL: "https://fail-21187-default-rtdb.firebaseio.com",
        projectId: "fail-21187",
        appId: "1:621043286513:web:dc826eaa4ddebb5cc14450"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
        document.getElementById('auth-ui').style.display = user ? 'none' : 'block';
        document.getElementById('app-ui').style.display = user ? 'block' : 'none';
        if(user) sync(user.uid);
    });

    async function authAction(type) {
        const e = document.getElementById('email').value;
        const p = document.getElementById('pass').value;
        try {
            if(type === 'reg') await auth.createUserWithEmailAndPassword(e, p);
            else await auth.signInWithEmailAndPassword(e, p);
        } catch(err) { alert("–û—à–∏–±–∫–∞: " + err.message); }
    }

    function sync(uid) {
        db.ref('users/' + uid).on('value', snap => {
            [1, 2].forEach(i => document.getElementById('l'+i).innerHTML = '');
            snap.forEach(child => {
                const item = child.val();
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <div>${item.type==='file'?'üìÑ':'üìå'} ${item.text}</div>
                    <button class="del" onclick="db.ref('users/${uid}/${child.key}').remove()">‚úï</button>
                    ${item.fileData ? `<a href="${item.fileData}" download="${item.text}" style="font-size:12px; color:blue;">–°–∫–∞—á–∞—Ç—å</a>` : ''}
                `;
                document.getElementById('l'+item.q).prepend(div);
            });
        });
    }

    async function addText(q) {
        const txt = document.getElementById('in'+q).value;
        if(txt) {
            await db.ref('users/' + auth.currentUser.uid).push({ q, text: txt, type: 'text' });
            document.getElementById('in'+q).value = '';
        }
    }

    function upFile(q) {
        const file = document.getElementById('f'+q).files[0];
        if(!file) return;
        const reader = new FileReader();
        document.getElementById('loader').style.display = 'flex';
        reader.onload = async (e) => {
            await db.ref('users/' + auth.currentUser.uid).push({
                q, text: file.name, fileData: e.target.result, type: 'file'
            });
            document.getElementById('loader').style.display = 'none';
        };
        reader.readAsDataURL(file);
    }
</script>
</body>
</html>
